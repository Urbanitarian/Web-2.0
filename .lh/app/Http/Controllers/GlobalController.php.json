{
    "sourceFile": "app/Http/Controllers/GlobalController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 53,
            "patches": [
                {
                    "date": 1683377145690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1687165212858,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,16 +24,19 @@\n use Maatwebsite\\Excel\\Facades\\Excel;\n use Backpack\\Settings\\app\\Models\\Setting;\n use Carbon\\Carbon;\n use App\\Mail\\MyMailsubmit;\n+use App\\Models\\Collection;\n+use App\\Models\\CollectionName;\n use Backpack\\CRUD\\app\\Http\\Controllers\\CrudController;\n use Backpack\\CRUD\\app\\Library\\CrudPanel\\CrudPanelFacade as CRUD;\n use Pestopancake\\LaravelBackpackNotifications\\Notifications\\DatabaseNotification;\n use Illuminate\\Contracts\\Pagination\\Paginator;\n use Illuminate\\Contracts\\View\\View;\n use Illuminate\\Http\\Request;\n use Illuminate\\Pagination\\LengthAwarePaginator;\n use Illuminate\\Support\\Facades\\Auth;\n+use Illuminate\\Support\\Facades\\Hash;\n use Illuminate\\Support\\Facades\\Mail;\n use Illuminate\\Support\\Facades\\Session;\n \n class GlobalController extends Controller\n@@ -56,41 +59,34 @@\n         $q = request()->input('q');\n \n \n \n-        if ($request->filled('q')) { \n-            $masters = Masterplan::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n-            $streets = Streetscape::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n-            $neighbs = Neighbourhood::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n-        }\n-        elseif ($request->filled('tags')) { \n+        if ($request->filled('q')) {\n+            $masters = Masterplan::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n+            $streets = Streetscape::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n+            $neighbs = Neighbourhood::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n+        } elseif ($request->filled('tags')) {\n             $tags = explode(',', $tags);\n             $masters = Masterplan::whereIn('tags', $tags)->get();\n             $streets = Streetscape::whereIn('tags', $tags)->get();\n             $neighbs = Neighbourhood::whereIn('tags', $tags)->get();\n-        } elseif ($request->filled('size')) \n-        { \n+        } elseif ($request->filled('size')) {\n             $masters = Masterplan::where('size', '=', $size)->get();\n             $streets = Streetscape::where('size', '=', $size)->get();\n             $neighbs = Neighbourhood::where('size', '=', $size)->get();\n-        } \n-        elseif ($request->filled('status')) \n-        { \n+        } elseif ($request->filled('status')) {\n             $masters = Masterplan::where('status', '=', $status)->get();\n             $streets = Streetscape::where('status', '=', $status)->get();\n             $neighbs = Neighbourhood::where('status', '=', $status)->get();\n-        } elseif ($request->filled('city')) \n-        { \n+        } elseif ($request->filled('city')) {\n             $masters = Masterplan::where('city', '=', $city)->get();\n             $streets = Streetscape::where('city', '=', $city)->get();\n             $neighbs = Neighbourhood::where('city', '=', $city)->get();\n-        } elseif ($request->filled('country')) \n-        { \n+        } elseif ($request->filled('country')) {\n             $masters = Masterplan::where('country', '=', $country)->get();\n             $streets = Streetscape::where('country', '=', $country)->get();\n             $neighbs = Neighbourhood::where('country', '=', $country)->get();\n-        }  elseif ($request->filled('category')) \n-        { \n+        } elseif ($request->filled('category')) {\n             if ($category == 'All') {\n                 $masters = Masterplan::all();\n                 $streets = Streetscape::all();\n                 $neighbs = Neighbourhood::all();\n@@ -98,34 +94,30 @@\n                 $masters = Masterplan::where('category', '=', $category)->get();\n                 $streets = Streetscape::where('category', '=', $category)->get();\n                 $neighbs = Neighbourhood::where('category', '=', $category)->get();\n             }\n-        } elseif ($request->filled('popular')) \n-        { \n+        } elseif ($request->filled('popular')) {\n             if ($popular == 'new') {\n                 $masters = Masterplan::orderBy('id', 'desc')->get();\n                 $streets = Streetscape::orderBy('id', 'desc')->get();\n                 $neighbs = Neighbourhood::orderBy('id', 'desc')->get();\n-            }\n-            else if ($popular == 'old'){\n+            } else if ($popular == 'old') {\n                 $masters = Masterplan::orderBy('id', 'asc')->get();\n                 $streets = Streetscape::orderBy('id', 'asc')->get();\n                 $neighbs = Neighbourhood::orderBy('id', 'asc')->get();\n             }\n-           \n-        } else\n-        {\n+        } else {\n             $masters = Masterplan::all();\n             $streets = Streetscape::all();\n             $neighbs = Neighbourhood::all();\n         }\n- \n-         //count number of masterplan\n-            $masternum = Masterplan::where('active', '1')->count();\n-            $streetnum = Streetscape::where('active', '1')->count();\n-            $urbannum = Neighbourhood::where('active', '1')->count();\n-          \n \n+        //count number of masterplan\n+        $masternum = Masterplan::where('active', '1')->count();\n+        $streetnum = Streetscape::where('active', '1')->count();\n+        $urbannum = Neighbourhood::where('active', '1')->count();\n+\n+\n         $all_data = array_merge(\n             $masters->toArray(),\n             $streets->toArray(),\n             $neighbs->toArray()\n@@ -151,14 +143,29 @@\n         $insta = Setting::get('curator_link');\n \n         return view(\n             'index',\n-            compact('dictionary','magazines','webresources','insta','streetscapes','masterplans','countries','cities','neighbourhoods','units', 'all_data', 'masternum', 'streetnum', 'urbannum'\n+            compact(\n+                'dictionary',\n+                'magazines',\n+                'webresources',\n+                'insta',\n+                'streetscapes',\n+                'masterplans',\n+                'countries',\n+                'cities',\n+                'neighbourhoods',\n+                'units',\n+                'all_data',\n+                'masternum',\n+                'streetnum',\n+                'urbannum'\n             )\n         );\n     }\n \n-    static function alldata(){\n+    static function alldata()\n+    {\n \n         $masters = Masterplan::all();\n         $streets = Streetscape::all();\n         $neighbs = Neighbourhood::all();\n@@ -180,25 +187,25 @@\n     }\n \n     public function about()\n     {\n-      \n+\n         return view('about');\n     }\n \n     public function people()\n     {\n         $team = Team::all()->sortByDesc('id');\n \n-        return view('people' , compact('team'));\n+        return view('people', compact('team'));\n     }\n \n     public function contact()\n     {\n         return view('contact');\n     }\n \n-       public function submit()\n+    public function submit()\n     {\n         return view('submit');\n     }\n \n@@ -226,9 +233,9 @@\n         $size = request()->input('size');\n         $tags = request()->input('tags');\n \n         if ($q) {\n-            $neighbourhoods = neighbourhood::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(8);\n+            $neighbourhoods = neighbourhood::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(8);\n         } elseif ($size) {\n             $neighbourhoods = neighbourhood::where('size', 'like', '%' . $size . '%')->paginate(8);\n         } elseif ($tags) {\n             $neighbourhoods = neighbourhood::where('tags', 'like', '%' . $tags . '%')->paginate(8);\n@@ -241,24 +248,41 @@\n \n     public function neighbourhoods_post(Request $request)\n     {\n         $id = $request->id;\n-        $neighbourhood = neighbourhood::all();\n-        $neighbourhoods = neighbourhood::where('id', '!=', null)->limit(4)\n+        $nb = Neighbourhood::find($id);\n+        $urbanscape = neighbourhood::all();\n+        $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n             ->inRandomOrder()\n             ->get();\n-        return view('neighbourhoods_post', compact('neighbourhood', 'neighbourhoods', 'id'));\n+        $streetscapes = Streetscape::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+        $masterplans = Masterplan::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+\n+\n+        // dd($masterplans);\n+\n+        views($nb)->record();\n+\n+\n+\n+        $collections = CollectionName::all();\n+\n+        return view('neighbourhoods_post', compact('urbanscape', 'collections', 'urbanscapes', 'streetscapes', 'masterplans',  'id'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n         $q = request()->input('q');\n         $tags = request()->input('tags');\n \n         if ($q) {\n-            $streetscapes = Streetscape::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(5);\n+            $streetscapes = Streetscape::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(5);\n         } elseif ($tags) {\n-            $streetscapes = Streetscape::where('title','like','%' . $tags . '%')->orWhere('tags', 'like', '%' . $tags . '%')->orWhere('category', 'like', '%' . $tags . '%')->orWhere('city', 'like', '%' . $tags . '%')->orWhere('country', 'like', '%' . $tags . '%')->paginate(5);\n+            $streetscapes = Streetscape::where('title', 'like', '%' . $tags . '%')->orWhere('tags', 'like', '%' . $tags . '%')->orWhere('category', 'like', '%' . $tags . '%')->orWhere('city', 'like', '%' . $tags . '%')->orWhere('country', 'like', '%' . $tags . '%')->paginate(5);\n         } else {\n             $streetscapes = Streetscape::paginate(5);\n         }\n \n@@ -266,32 +290,49 @@\n     }\n \n     public function streetscapes_post(Request $request)\n     {\n+\n         $id = $request->id;\n-        $allstreetscapes = Streetscape::where('id', '!=', null)->limit(3)->inRandomOrder()->get();\n+        $st = Streetscape::find($id);\n+\n+\n         $streetscapes = Streetscape::all();\n-        return view('streetscapes_post', compact('streetscapes', 'allstreetscapes', 'id'));\n+\n+        $masterplans = Masterplan::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+\n+        $allstreetscapes = Streetscape::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+\n+        views($st)->record();\n+\n+        $collections = CollectionName::all();\n+\n+        return view('streetscapes_post', compact('streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n         $q = request()->input('q');\n         $size = request()->input('size');\n         $city = request()->input('city');\n         $country = request()->input('country');\n-        \n+\n         if ($q) {\n-            $masterplans = Masterplan::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(10);\n+            $masterplans = Masterplan::where('title', 'like', '%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(10);\n         } elseif ($size) {\n             $masterplans = Masterplan::where('size', 'like', '%' . $size . '%')->paginate(10);\n-        }  elseif ($request->filled('city')) \n-        { \n+        } elseif ($request->filled('city')) {\n             $masters = Masterplan::where('city', '=', $city)->paginate(10);\n             $streets = Streetscape::where('city', '=', $city)->paginate(10);\n             $neighbs = Neighbourhood::where('city', '=', $city)->paginate(10);\n-        } elseif ($request->filled('country')) \n-        { \n+        } elseif ($request->filled('country')) {\n             $masters = Masterplan::where('country', '=', $country)->paginate(10);\n             $streets = Streetscape::where('country', '=', $country)->paginate(10);\n             $neighbs = Neighbourhood::where('country', '=', $country)->paginate(10);\n         } else {\n@@ -306,15 +347,31 @@\n \n     public function masterplans_post(Request $request)\n     {\n         $id = $request->id;\n+        $mas = Masterplan::find($id);\n         $masterplan = Masterplan::all();\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n \n-        return view('masterplans_post', compact('masterplan', 'masterplans', 'id'));\n+            echo 'a';\n+        die();    \n+        $streetscapes = Streetscape::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n+\n+\n+        views($mas)->record();\n+\n+        $collections = CollectionName::all();\n+\n+\n+        return view('masterplans_post', compact('masterplan', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function alldictionary()\n     {\n@@ -445,9 +502,9 @@\n     {\n         return view('legal');\n     }\n \n-    \n+\n     static function association()\n     {\n         return view('association');\n     }\n@@ -471,27 +528,27 @@\n     {\n         return view('work');\n     }\n \n-    public function import(Request $request) \n+    public function import(Request $request)\n     {\n         $request->validate([\n             'file' => 'required|mimes:xls,xlsx'\n         ]);\n \n         $file = $request->file('file');\n \n-        if ($request->dataType == \"masterplans\"){\n+        if ($request->dataType == \"masterplans\") {\n             Excel::import(new MasterplansImport, $file);\n-        } elseif ($request->dataType == \"neighbourhoods\"){\n+        } elseif ($request->dataType == \"neighbourhoods\") {\n             Excel::import(new NeighbourhoodsImport, $file);\n-        } elseif ($request->dataType == \"streetscapes\"){\n+        } elseif ($request->dataType == \"streetscapes\") {\n             Excel::import(new StreetscapesImport, $file);\n-        } elseif  ($request->dataType == \"dictionaries\"){\n+        } elseif ($request->dataType == \"dictionaries\") {\n             Excel::import(new DictionariesImport, $file);\n-        } elseif  ($request->dataType == \"magazines\"){\n+        } elseif ($request->dataType == \"magazines\") {\n             Excel::import(new MagazinesImport, $file);\n-        } elseif  ($request->dataType == \"webresources\"){\n+        } elseif ($request->dataType == \"webresources\") {\n             Excel::import(new WebresourcesImport, $file);\n         } else {\n             \\Alert::success('Error.')->flash();\n             return redirect('/admin')->with('error', 'Invalid data type.');\n@@ -499,6 +556,29 @@\n         \\Alert::success('Excel data imported successfully.')->flash();\n         return redirect('/admin')->with('success', 'Data imported successfully.');\n     }\n \n+    public function userLogin(Request $req)\n+    {\n+        $user = User::where('email', $req->email)->orWhere('role', 'user')->first();\n+        if ($user) {\n+            if (Hash::make($user->password == $req->password)) {\n+                $req->session()->put('FRONT_USER_LOGIN', true);\n+                $req->session()->put('FRONT_USER_ID', $user->id);\n+                $req->session()->put('FRONT_USER_NAME', $user->name);\n+                return redirect('/');\n+            }\n+        } else {\n+            \\Alert::error('User with this email does not exist.')->flash();\n+            return redirect('/')->with('error', 'User with this email does not exist.');\n+        }\n+    }\n \n+\n+\n+    public function login(Request $req)\n+    {\n+        if (!$req->session()->get('FRON_USER_LOGIN')) {\n+            return view('parts.login');\n+        }\n+    }\n }\n"
                },
                {
                    "date": 1687165243807,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -353,11 +353,8 @@\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-\n-            echo 'a';\n-        die();    \n         $streetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n"
                },
                {
                    "date": 1687165315792,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -353,10 +353,9 @@\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        $streetscapes = Streetscape::where('id', '!=', null)\n-            ->inRandomOrder()\n+        $streetscapes = Streetscape::where('masterplan_id',$masterplans->id)\n             ->get();\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n"
                },
                {
                    "date": 1687165339014,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -353,9 +353,9 @@\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        $streetscapes = Streetscape::where('masterplan_id',$masterplans->id)\n+        $streetscapes = Streetscape::where('masterplan_id',$mas->id)\n             ->get();\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n"
                },
                {
                    "date": 1687165415821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -353,13 +353,10 @@\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        $streetscapes = Streetscape::where('masterplan_id',$mas->id)\n-            ->get();\n-        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->get();\n+        $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n+        $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n         views($mas)->record();\n \n"
                },
                {
                    "date": 1687165558796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -354,8 +354,11 @@\n             ->inRandomOrder()\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n+\n+        var_dump($streetscapes);\n+\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n         views($mas)->record();\n"
                },
                {
                    "date": 1687165644756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -355,9 +355,8 @@\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n-        var_dump($streetscapes);\n \n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n"
                },
                {
                    "date": 1687165693814,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -354,10 +354,10 @@\n             ->inRandomOrder()\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n+        \n \n-\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n         views($mas)->record();\n"
                },
                {
                    "date": 1687165704631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -354,10 +354,11 @@\n             ->inRandomOrder()\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n-        \n \n+        dd($streetscapes);\n+\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n         views($mas)->record();\n"
                },
                {
                    "date": 1687165761955,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,8 +356,13 @@\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n         dd($streetscapes);\n+        if($streetscapes){\n+            echo 'good';\n+        }else{\n+            'no';\n+        }\n \n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n"
                },
                {
                    "date": 1687165767722,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -355,9 +355,9 @@\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n-        dd($streetscapes);\n+        // dd($streetscapes);\n         if($streetscapes){\n             echo 'good';\n         }else{\n             'no';\n"
                },
                {
                    "date": 1687165798659,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -356,9 +356,9 @@\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n         // dd($streetscapes);\n-        if($streetscapes){\n+        if ($streetscapes->isEmpty()) {\n             echo 'good';\n         }else{\n             'no';\n         }\n"
                },
                {
                    "date": 1687165810383,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,11 +357,11 @@\n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n         // dd($streetscapes);\n         if ($streetscapes->isEmpty()) {\n-            echo 'good';\n+            echo 'yes empty';\n         }else{\n-            'no';\n+            'no empty';\n         }\n \n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n"
                },
                {
                    "date": 1687165819136,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -355,15 +355,8 @@\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n \n-        // dd($streetscapes);\n-        if ($streetscapes->isEmpty()) {\n-            echo 'yes empty';\n-        }else{\n-            'no empty';\n-        }\n-\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n \n \n         views($mas)->record();\n"
                },
                {
                    "date": 1687167133833,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -348,9 +348,9 @@\n     public function masterplans_post(Request $request)\n     {\n         $id = $request->id;\n         $mas = Masterplan::find($id);\n-        $masterplan = Masterplan::all();\n+        $masterplan = $mas;\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n"
                },
                {
                    "date": 1687167228544,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -347,25 +347,25 @@\n \n     public function masterplans_post(Request $request)\n     {\n         $id = $request->id;\n-        $mas = Masterplan::find($id);\n-        $masterplan = $mas;\n+        $item = Masterplan::find($id);\n+\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        $streetscapes = Streetscape::where('masterplan_id',$mas->id)->get();\n+        $streetscapes = Streetscape::where('masterplan_id',$item->id)->get();\n \n-        $urbanscapes =  Neighbourhood::where('masterplan_id',$mas->id)->get();\n+        $urbanscapes =  Neighbourhood::where('masterplan_id',$item->id)->get();\n \n \n         views($mas)->record();\n \n         $collections = CollectionName::all();\n \n \n-        return view('masterplans_post', compact('masterplan', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n+        return view('masterplans_post', compact('item', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function alldictionary()\n     {\n"
                },
                {
                    "date": 1687167235208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -358,9 +358,9 @@\n \n         $urbanscapes =  Neighbourhood::where('masterplan_id',$item->id)->get();\n \n \n-        views($mas)->record();\n+        views($item)->record();\n \n         $collections = CollectionName::all();\n \n \n"
                },
                {
                    "date": 1687167321240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -351,8 +351,9 @@\n         $item = Masterplan::find($id);\n \n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n+            ->take(12)\n             ->get();\n \n         $streetscapes = Streetscape::where('masterplan_id',$item->id)->get();\n \n"
                },
                {
                    "date": 1687167874190,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -348,24 +348,43 @@\n     public function masterplans_post(Request $request)\n     {\n         $id = $request->id;\n         $item = Masterplan::find($id);\n-\n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->take(12)\n             ->get();\n-\n         $streetscapes = Streetscape::where('masterplan_id',$item->id)->get();\n-\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$item->id)->get();\n+        views($item)->record();\n+        $collections = CollectionName::all();\n \n \n-        views($item)->record();\n+        $next = Masterplan::where('id', '>', $item->id)\n+        ->orderBy('id', 'asc')\n+        ->select('id')\n+        ->first();\n \n-        $collections = CollectionName::all();\n+        if (!$next) {\n+            Masterplan::orderBy('id', 'asc')\n+                    ->select('id')\n+                    ->first();\n+        }\n \n+        $prev = Masterplan::where('id', '<', $item->id)\n+            ->orderBy('id', 'desc')\n+            ->select('id')\n+            ->first();\n+        if (!$prev) {\n+            $prev = Masterplan::orderBy('id', 'desc')\n+                    ->select('id')\n+                    ->first();\n+        }\n+        $nextToken = $nextGroup ? $nextGroup->token : null;\n+        $prevToken = $prevGroup ? $prevGroup->token : null;\n \n+\n+\n         return view('masterplans_post', compact('item', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function alldictionary()\n"
                },
                {
                    "date": 1687167892957,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -378,10 +378,10 @@\n             $prev = Masterplan::orderBy('id', 'desc')\n                     ->select('id')\n                     ->first();\n         }\n-        $nextToken = $nextGroup ? $nextGroup->token : null;\n-        $prevToken = $prevGroup ? $prevGroup->token : null;\n+        $next= $next ? $next->id : null;\n+        $prev = $prev ? $prev->id : null;\n \n \n \n         return view('masterplans_post', compact('item', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n"
                },
                {
                    "date": 1687167899260,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,9 +357,8 @@\n         $urbanscapes =  Neighbourhood::where('masterplan_id',$item->id)->get();\n         views($item)->record();\n         $collections = CollectionName::all();\n \n-\n         $next = Masterplan::where('id', '>', $item->id)\n         ->orderBy('id', 'asc')\n         ->select('id')\n         ->first();\n"
                },
                {
                    "date": 1687167926943,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -382,9 +382,9 @@\n         $prev = $prev ? $prev->id : null;\n \n \n \n-        return view('masterplans_post', compact('item', 'masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n+        return view('masterplans_post', compact('item','next','prev','masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function alldictionary()\n     {\n"
                },
                {
                    "date": 1687167954330,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -377,10 +377,10 @@\n             $prev = Masterplan::orderBy('id', 'desc')\n                     ->select('id')\n                     ->first();\n         }\n-        $next= $next ? $next->id : null;\n-        $prev = $prev ? $prev->id : null;\n+        $next_id= $next ? $next->id : null;\n+        $prev_id = $prev ? $prev->id : null;\n \n \n \n         return view('masterplans_post', compact('item','next','prev','masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n"
                },
                {
                    "date": 1687167961720,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -382,9 +382,9 @@\n         $prev_id = $prev ? $prev->id : null;\n \n \n \n-        return view('masterplans_post', compact('item','next','prev','masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n+        return view('masterplans_post', compact('item','next_id','prev_id','masterplans', 'collections', 'streetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function alldictionary()\n     {\n"
                },
                {
                    "date": 1687204859932,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,9 +292,9 @@\n     public function streetscapes_post(Request $request)\n     {\n \n         $id = $request->id;\n-        $st = Streetscape::find($id);\n+        $item = Streetscape::find($id);\n \n \n         $streetscapes = Streetscape::all();\n \n@@ -308,13 +308,13 @@\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        views($st)->record();\n+        views($item)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n+        return view('streetscapes_post', compact('item','streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687204928504,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,9 +292,9 @@\n     public function streetscapes_post(Request $request)\n     {\n \n         $id = $request->id;\n-        $item = Streetscape::find($id);\n+        $st = Streetscape::find($id);\n \n \n         $streetscapes = Streetscape::all();\n \n@@ -308,13 +308,13 @@\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        views($item)->record();\n+        views($st)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('item','streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n+        return view('streetscapes_post', compact('streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687205160463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,9 +292,9 @@\n     public function streetscapes_post(Request $request)\n     {\n \n         $id = $request->id;\n-        $st = Streetscape::find($id);\n+        $item = Streetscape::find($id);\n \n \n         $streetscapes = Streetscape::all();\n \n"
                },
                {
                    "date": 1687205190148,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -297,9 +297,9 @@\n \n \n         $streetscapes = Streetscape::all();\n \n-        $masterplans = Masterplan::where('id', '!=', null)\n+        $masterplans = Masterplan::where('id',$item->masterplan_id)\n             ->inRandomOrder()\n             ->get();\n \n         $allstreetscapes = Streetscape::where('id', '!=', null)\n@@ -308,9 +308,9 @@\n         $urbanscapes =  Neighbourhood::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n-        views($st)->record();\n+        views($item)->record();\n \n         $collections = CollectionName::all();\n \n         return view('streetscapes_post', compact('streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n"
                },
                {
                    "date": 1687205195299,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -297,11 +297,9 @@\n \n \n         $streetscapes = Streetscape::all();\n \n-        $masterplans = Masterplan::where('id',$item->masterplan_id)\n-            ->inRandomOrder()\n-            ->get();\n+        $masterplans = Masterplan::where('id',$item->masterplan_id)->get();\n \n         $allstreetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n"
                },
                {
                    "date": 1687205211216,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -297,9 +297,9 @@\n \n \n         $streetscapes = Streetscape::all();\n \n-        $masterplans = Masterplan::where('id',$item->masterplan_id)->get();\n+        $masterplans = Masterplan::where('id',$item->masterplan_id)->first();\n \n         $allstreetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n"
                },
                {
                    "date": 1687205296814,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -297,9 +297,9 @@\n \n \n         $streetscapes = Streetscape::all();\n \n-        $masterplans = Masterplan::where('id',$item->masterplan_id)->first();\n+        $master = Masterplan::where('id',$item->masterplan_id)->first();\n \n         $allstreetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n@@ -310,9 +310,9 @@\n         views($item)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'masterplans', 'id'));\n+        return view('streetscapes_post', compact('master','streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687205493432,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -293,20 +293,24 @@\n     {\n \n         $id = $request->id;\n         $item = Streetscape::find($id);\n+        $master = Masterplan::where('id',$item->masterplan_id)->first();\n+        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n+            ->inRandomOrder()\n+            ->get();\n \n \n+        \n+\n         $streetscapes = Streetscape::all();\n \n-        $master = Masterplan::where('id',$item->masterplan_id)->first();\n+       \n \n         $allstreetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n-        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->get();\n+        \n \n         views($item)->record();\n \n         $collections = CollectionName::all();\n"
                },
                {
                    "date": 1687205518952,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -294,11 +294,9 @@\n \n         $id = $request->id;\n         $item = Streetscape::find($id);\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n-        $urbanscapes =  Neighbourhood::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->get();\n+        $urbanscapes =  Neighbourhood::where('id',$item->masterplan_id)->get();\n \n \n         \n \n"
                },
                {
                    "date": 1687205548746,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -312,9 +312,9 @@\n         views($item)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('master','streetscapes', 'collections', 'allstreetscapes', 'urbanscapes', 'id'));\n+        return view('streetscapes_post', compact('master','streetscapes', 'collections', 'allstreetscapes', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687205836234,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -303,18 +303,19 @@\n         $streetscapes = Streetscape::all();\n \n        \n \n-        $allstreetscapes = Streetscape::where('id', '!=', null)\n+        $streetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n+            ->take(12)\n             ->get();\n         \n \n         views($item)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('master','streetscapes', 'collections', 'allstreetscapes', 'id'));\n+        return view('streetscapes_post', compact('master','urbanscapes','streetscapes', 'collections',, 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687205843537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -295,16 +295,8 @@\n         $id = $request->id;\n         $item = Streetscape::find($id);\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n         $urbanscapes =  Neighbourhood::where('id',$item->masterplan_id)->get();\n-\n-\n-        \n-\n-        $streetscapes = Streetscape::all();\n-\n-       \n-\n         $streetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->take(12)\n             ->get();\n@@ -313,9 +305,9 @@\n         views($item)->record();\n \n         $collections = CollectionName::all();\n \n-        return view('streetscapes_post', compact('master','urbanscapes','streetscapes', 'collections',, 'id'));\n+        return view('streetscapes_post', compact('master','urbanscapes','streetscapes', 'collections', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687205876380,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -295,9 +295,9 @@\n         $id = $request->id;\n         $item = Streetscape::find($id);\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n         $urbanscapes =  Neighbourhood::where('id',$item->masterplan_id)->get();\n-        $streetscapes = Streetscape::where('id', '!=', null)\n+        $streetscapes = Streetscape::where('id', '!=', null)->where('id', '!=', $id)\n             ->inRandomOrder()\n             ->take(12)\n             ->get();\n         \n"
                },
                {
                    "date": 1687205909666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -295,9 +295,9 @@\n         $id = $request->id;\n         $item = Streetscape::find($id);\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n         $urbanscapes =  Neighbourhood::where('id',$item->masterplan_id)->get();\n-        $streetscapes = Streetscape::where('id', '!=', null)->where('id', '!=', $id)\n+        $streetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->take(12)\n             ->get();\n         \n"
                },
                {
                    "date": 1687205940677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -299,9 +299,8 @@\n         $streetscapes = Streetscape::where('id', '!=', null)\n             ->inRandomOrder()\n             ->take(12)\n             ->get();\n-        \n \n         views($item)->record();\n \n         $collections = CollectionName::all();\n"
                },
                {
                    "date": 1687205960031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -304,8 +304,34 @@\n         views($item)->record();\n \n         $collections = CollectionName::all();\n \n+\n+        $next = Masterplan::where('id', '>', $item->id)\n+        ->orderBy('id', 'asc')\n+        ->select('id')\n+        ->first();\n+\n+        if (!$next) {\n+            Masterplan::orderBy('id', 'asc')\n+                    ->select('id')\n+                    ->first();\n+        }\n+\n+        $prev = Masterplan::where('id', '<', $item->id)\n+            ->orderBy('id', 'desc')\n+            ->select('id')\n+            ->first();\n+        if (!$prev) {\n+            $prev = Masterplan::orderBy('id', 'desc')\n+                    ->select('id')\n+                    ->first();\n+        }\n+        $next_id= $next ? $next->id : null;\n+        $prev_id = $prev ? $prev->id : null;\n+\n+\n+\n         return view('streetscapes_post', compact('master','urbanscapes','streetscapes', 'collections', 'id'));\n     }\n \n     public function masterplans(Request $request)\n"
                },
                {
                    "date": 1687205980774,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -305,25 +305,25 @@\n \n         $collections = CollectionName::all();\n \n \n-        $next = Masterplan::where('id', '>', $item->id)\n+        $next = Streetscape::where('id', '>', $item->id)\n         ->orderBy('id', 'asc')\n         ->select('id')\n         ->first();\n \n         if (!$next) {\n-            Masterplan::orderBy('id', 'asc')\n+            Streetscape::orderBy('id', 'asc')\n                     ->select('id')\n                     ->first();\n         }\n \n-        $prev = Masterplan::where('id', '<', $item->id)\n+        $prev = Streetscape::where('id', '<', $item->id)\n             ->orderBy('id', 'desc')\n             ->select('id')\n             ->first();\n         if (!$prev) {\n-            $prev = Masterplan::orderBy('id', 'desc')\n+            $prev = Streetscape::orderBy('id', 'desc')\n                     ->select('id')\n                     ->first();\n         }\n         $next_id= $next ? $next->id : null;\n"
                },
                {
                    "date": 1687205995844,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -330,9 +330,9 @@\n         $prev_id = $prev ? $prev->id : null;\n \n \n \n-        return view('streetscapes_post', compact('master','urbanscapes','streetscapes', 'collections', 'id'));\n+        return view('streetscapes_post', compact('master','next_id','prev_id','urbanscapes','streetscapes', 'collections', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687206097298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -330,9 +330,9 @@\n         $prev_id = $prev ? $prev->id : null;\n \n \n \n-        return view('streetscapes_post', compact('master','next_id','prev_id','urbanscapes','streetscapes', 'collections', 'id'));\n+        return view('streetscapes_post', compact('item','master','next_id','prev_id','urbanscapes','streetscapes', 'collections', 'id'));\n     }\n \n     public function masterplans(Request $request)\n     {\n"
                },
                {
                    "date": 1687209169116,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -261,10 +261,8 @@\n             ->inRandomOrder()\n             ->get();\n \n \n-        // dd($masterplans);\n-\n         views($nb)->record();\n \n \n \n"
                },
                {
                    "date": 1687209203020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,9 +248,11 @@\n \n     public function neighbourhoods_post(Request $request)\n     {\n         $id = $request->id;\n-        $nb = Neighbourhood::find($id);\n+        $item = Neighbourhood::find($id);\n+\n+        \n         $urbanscape = neighbourhood::all();\n         $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n             ->inRandomOrder()\n             ->get();\n@@ -261,9 +263,9 @@\n             ->inRandomOrder()\n             ->get();\n \n \n-        views($nb)->record();\n+        views($item)->record();\n \n \n \n         $collections = CollectionName::all();\n"
                },
                {
                    "date": 1687209310130,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -249,17 +249,15 @@\n     public function neighbourhoods_post(Request $request)\n     {\n         $id = $request->id;\n         $item = Neighbourhood::find($id);\n+        $streetscapes = Streetscape::where('id',$item->masterplan_id)->get();\n \n-        \n         $urbanscape = neighbourhood::all();\n         $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n             ->inRandomOrder()\n             ->get();\n-        $streetscapes = Streetscape::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->get();\n+        \n         $masterplans = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n@@ -269,9 +267,9 @@\n \n \n         $collections = CollectionName::all();\n \n-        return view('neighbourhoods_post', compact('urbanscape', 'collections', 'urbanscapes', 'streetscapes', 'masterplans',  'id'));\n+        return view('neighbourhoods_post', compact('streetscapes', 'urbanscape', 'collections', 'urbanscapes', 'masterplans',  'id'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n"
                },
                {
                    "date": 1687209570208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,9 +256,9 @@\n         $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n             ->inRandomOrder()\n             ->get();\n         \n-        $masterplans = Masterplan::where('id', '!=', null)\n+        $master = Masterplan::where('id', '!=', null)\n             ->inRandomOrder()\n             ->get();\n \n \n@@ -267,9 +267,9 @@\n \n \n         $collections = CollectionName::all();\n \n-        return view('neighbourhoods_post', compact('streetscapes', 'urbanscape', 'collections', 'urbanscapes', 'masterplans',  'id'));\n+        return view('neighbourhoods_post', compact('streetscapes', 'master', 'urbanscape', 'collections', 'urbanscapes',  'id'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n"
                },
                {
                    "date": 1687209591940,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -250,19 +250,19 @@\n     {\n         $id = $request->id;\n         $item = Neighbourhood::find($id);\n         $streetscapes = Streetscape::where('id',$item->masterplan_id)->get();\n+        $master = Masterplan::where('id',$item->masterplan_id)->first();\n \n+\n         $urbanscape = neighbourhood::all();\n         $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n             ->inRandomOrder()\n             ->get();\n         \n-        $master = Masterplan::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->get();\n \n \n+\n         views($item)->record();\n \n \n \n"
                },
                {
                    "date": 1687209707905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -254,9 +254,10 @@\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n \n \n         $urbanscape = neighbourhood::all();\n-        $urbanscapes = neighbourhood::where('id', '!=', null)->limit(4)\n+        $urbanscapes = neighbourhood::where('id', '!=', null)\n+            ->limit(12)\n             ->inRandomOrder()\n             ->get();\n         \n \n"
                },
                {
                    "date": 1687209733274,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,10 +255,10 @@\n \n \n         $urbanscape = neighbourhood::all();\n         $urbanscapes = neighbourhood::where('id', '!=', null)\n-            ->limit(12)\n             ->inRandomOrder()\n+            ->take(12)\n             ->get();\n         \n \n \n"
                },
                {
                    "date": 1687209767507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,16 +251,16 @@\n         $id = $request->id;\n         $item = Neighbourhood::find($id);\n         $streetscapes = Streetscape::where('id',$item->masterplan_id)->get();\n         $master = Masterplan::where('id',$item->masterplan_id)->first();\n+        $urbanscapes = neighbourhood::where('id', '!=', null)\n+        ->inRandomOrder()\n+        ->take(12)\n+        ->get();\n \n-\n         $urbanscape = neighbourhood::all();\n-        $urbanscapes = neighbourhood::where('id', '!=', null)\n-            ->inRandomOrder()\n-            ->take(12)\n-            ->get();\n         \n+        \n \n \n \n         views($item)->record();\n@@ -268,9 +268,9 @@\n \n \n         $collections = CollectionName::all();\n \n-        return view('neighbourhoods_post', compact('streetscapes', 'master', 'urbanscape', 'collections', 'urbanscapes',  'id'));\n+        return view('neighbourhoods_post', compact('streetscapes', 'master', 'collections', 'urbanscapes',  'id','urbanscape'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n"
                },
                {
                    "date": 1687209805451,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -268,9 +268,9 @@\n \n \n         $collections = CollectionName::all();\n \n-        return view('neighbourhoods_post', compact('streetscapes', 'master', 'collections', 'urbanscapes',  'id','urbanscape'));\n+        return view('neighbourhoods_post', compact('item','streetscapes', 'master', 'collections', 'urbanscapes',  'id','urbanscape'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n"
                },
                {
                    "date": 1687209878647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,21 +256,39 @@\n         ->inRandomOrder()\n         ->take(12)\n         ->get();\n \n-        $urbanscape = neighbourhood::all();\n-        \n-        \n \n+        views($item)->record();\n \n+        $collections = CollectionName::all();\n \n-        views($item)->record();\n \n+        $next = Neighbourhood::where('id', '>', $item->id)\n+        ->orderBy('id', 'asc')\n+        ->select('id')\n+        ->first();\n \n+        if (!$next) {\n+            Neighbourhood::orderBy('id', 'asc')\n+                    ->select('id')\n+                    ->first();\n+        }\n \n-        $collections = CollectionName::all();\n+        $prev = Neighbourhood::where('id', '<', $item->id)\n+            ->orderBy('id', 'desc')\n+            ->select('id')\n+            ->first();\n+        if (!$prev) {\n+            $prev = Neighbourhood::orderBy('id', 'desc')\n+                    ->select('id')\n+                    ->first();\n+        }\n+        $next_id= $next ? $next->id : null;\n+        $prev_id = $prev ? $prev->id : null;\n \n-        return view('neighbourhoods_post', compact('item','streetscapes', 'master', 'collections', 'urbanscapes',  'id','urbanscape'));\n+\n+        return view('neighbourhoods_post', compact('item','next_id','prev_id','streetscapes', 'master', 'collections', 'urbanscapes',  'id'));\n     }\n \n     public function streetscapes(Request $request)\n     {\n"
                }
            ],
            "date": 1683377145690,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\User;\nuse App\\Models\\Tag;\nuse App\\Models\\Dictionary;\nuse App\\Models\\Magazine;\nuse App\\Models\\Pages;\nuse App\\Models\\Streetscape;\nuse App\\Models\\Masterplan;\nuse App\\Models\\Team;\nuse App\\Models\\Neighbourhood;\nuse App\\Models\\Webresource;\nuse App\\Models\\Country;\nuse App\\Models\\City;\nuse App\\Models\\Mindscape;\nuse App\\Imports\\MasterplansImport;\nuse App\\Imports\\StreetscapesImport;\nuse App\\Imports\\NeighbourhoodsImport;\nuse App\\Imports\\DictionariesImport;\nuse App\\Imports\\MagazinesImport;\nuse App\\Imports\\WebresourcesImport;\nuse Maatwebsite\\Excel\\Facades\\Excel;\nuse Backpack\\Settings\\app\\Models\\Setting;\nuse Carbon\\Carbon;\nuse App\\Mail\\MyMailsubmit;\nuse Backpack\\CRUD\\app\\Http\\Controllers\\CrudController;\nuse Backpack\\CRUD\\app\\Library\\CrudPanel\\CrudPanelFacade as CRUD;\nuse Pestopancake\\LaravelBackpackNotifications\\Notifications\\DatabaseNotification;\nuse Illuminate\\Contracts\\Pagination\\Paginator;\nuse Illuminate\\Contracts\\View\\View;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Pagination\\LengthAwarePaginator;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Mail;\nuse Illuminate\\Support\\Facades\\Session;\n\nclass GlobalController extends Controller\n{\n    /**\n     * Handle the incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function getAll(Request $request)\n    {\n        $tags = request()->input('tags');\n        $size = request()->input('size');\n        $status = request()->input('status');\n        $city = request()->input('city');\n        $country = request()->input('country');\n        $category = request()->input('category');\n        $popular = request()->input('popular');\n        $q = request()->input('q');\n\n\n\n        if ($request->filled('q')) { \n            $masters = Masterplan::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n            $streets = Streetscape::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n            $neighbs = Neighbourhood::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->get();\n        }\n        elseif ($request->filled('tags')) { \n            $tags = explode(',', $tags);\n            $masters = Masterplan::whereIn('tags', $tags)->get();\n            $streets = Streetscape::whereIn('tags', $tags)->get();\n            $neighbs = Neighbourhood::whereIn('tags', $tags)->get();\n        } elseif ($request->filled('size')) \n        { \n            $masters = Masterplan::where('size', '=', $size)->get();\n            $streets = Streetscape::where('size', '=', $size)->get();\n            $neighbs = Neighbourhood::where('size', '=', $size)->get();\n        } \n        elseif ($request->filled('status')) \n        { \n            $masters = Masterplan::where('status', '=', $status)->get();\n            $streets = Streetscape::where('status', '=', $status)->get();\n            $neighbs = Neighbourhood::where('status', '=', $status)->get();\n        } elseif ($request->filled('city')) \n        { \n            $masters = Masterplan::where('city', '=', $city)->get();\n            $streets = Streetscape::where('city', '=', $city)->get();\n            $neighbs = Neighbourhood::where('city', '=', $city)->get();\n        } elseif ($request->filled('country')) \n        { \n            $masters = Masterplan::where('country', '=', $country)->get();\n            $streets = Streetscape::where('country', '=', $country)->get();\n            $neighbs = Neighbourhood::where('country', '=', $country)->get();\n        }  elseif ($request->filled('category')) \n        { \n            if ($category == 'All') {\n                $masters = Masterplan::all();\n                $streets = Streetscape::all();\n                $neighbs = Neighbourhood::all();\n            } else {\n                $masters = Masterplan::where('category', '=', $category)->get();\n                $streets = Streetscape::where('category', '=', $category)->get();\n                $neighbs = Neighbourhood::where('category', '=', $category)->get();\n            }\n        } elseif ($request->filled('popular')) \n        { \n            if ($popular == 'new') {\n                $masters = Masterplan::orderBy('id', 'desc')->get();\n                $streets = Streetscape::orderBy('id', 'desc')->get();\n                $neighbs = Neighbourhood::orderBy('id', 'desc')->get();\n            }\n            else if ($popular == 'old'){\n                $masters = Masterplan::orderBy('id', 'asc')->get();\n                $streets = Streetscape::orderBy('id', 'asc')->get();\n                $neighbs = Neighbourhood::orderBy('id', 'asc')->get();\n            }\n           \n        } else\n        {\n            $masters = Masterplan::all();\n            $streets = Streetscape::all();\n            $neighbs = Neighbourhood::all();\n        }\n \n         //count number of masterplan\n            $masternum = Masterplan::where('active', '1')->count();\n            $streetnum = Streetscape::where('active', '1')->count();\n            $urbannum = Neighbourhood::where('active', '1')->count();\n          \n\n        $all_data = array_merge(\n            $masters->toArray(),\n            $streets->toArray(),\n            $neighbs->toArray()\n        );\n        shuffle($all_data);\n\n        $units = new LengthAwarePaginator(\n            array_slice($all_data, 0, 8, true),\n            count($all_data),\n            8\n        );\n\n\n        //other parts\n        $cities = City::all();\n        $countries = Country::All();\n        $neighbourhoods = neighbourhood::where('id', '!=', null)->limit(4)->inRandomOrder()->get();\n        $masterplans = Masterplan::where('id', '!=', null)->limit(8)->inRandomOrder()->get();\n        $streetscapes = Streetscape::where('id', '!=', null)->limit(3)->inRandomOrder()->get();\n        $webresources = Webresource::where('id', '!=', null)->limit(5)->inRandomOrder()->get();\n        $magazines = Magazine::where('id', '!=', null)->limit(5)->inRandomOrder()->get();\n        $dictionary = Dictionary::where('id', '!=', null)->limit(10)->inRandomOrder()->get();\n        $insta = Setting::get('curator_link');\n\n        return view(\n            'index',\n            compact('dictionary','magazines','webresources','insta','streetscapes','masterplans','countries','cities','neighbourhoods','units', 'all_data', 'masternum', 'streetnum', 'urbannum'\n            )\n        );\n    }\n\n    static function alldata(){\n\n        $masters = Masterplan::all();\n        $streets = Streetscape::all();\n        $neighbs = Neighbourhood::all();\n\n        $all_data = array_merge(\n            $masters->toArray(),\n            $streets->toArray(),\n            $neighbs->toArray()\n        );\n\n        return $all_data;\n    }\n\n\n    static function pages()\n    {\n        $pages = Pages::all();\n        return $pages;\n    }\n\n    public function about()\n    {\n      \n        return view('about');\n    }\n\n    public function people()\n    {\n        $team = Team::all()->sortByDesc('id');\n\n        return view('people' , compact('team'));\n    }\n\n    public function contact()\n    {\n        return view('contact');\n    }\n\n       public function submit()\n    {\n        return view('submit');\n    }\n\n    public function submit_project(Request $request)\n    {\n        $usermail = env('MAIL_USERNAME');\n        $this->validate($request, [\n            'name' => 'required',\n            'email' => 'required|email',\n            'g-recaptcha-response' => 'required|recaptchav3:register,0.5'\n        ]);\n\n        Mail::to($usermail)->queue(new MyMailsubmit($request->all()));\n        return back()->with('Mail_envoye', 'ok');\n    }\n\n    public function contactus()\n    {\n        return view('contactus');\n    }\n\n    public function neighbourhoods(Request $request)\n    {\n        $q = request()->input('q');\n        $size = request()->input('size');\n        $tags = request()->input('tags');\n\n        if ($q) {\n            $neighbourhoods = neighbourhood::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(8);\n        } elseif ($size) {\n            $neighbourhoods = neighbourhood::where('size', 'like', '%' . $size . '%')->paginate(8);\n        } elseif ($tags) {\n            $neighbourhoods = neighbourhood::where('tags', 'like', '%' . $tags . '%')->paginate(8);\n        } else {\n            $neighbourhoods = neighbourhood::paginate(8);\n        }\n\n        return view('neighbourhoods', compact('neighbourhoods'));\n    }\n\n    public function neighbourhoods_post(Request $request)\n    {\n        $id = $request->id;\n        $neighbourhood = neighbourhood::all();\n        $neighbourhoods = neighbourhood::where('id', '!=', null)->limit(4)\n            ->inRandomOrder()\n            ->get();\n        return view('neighbourhoods_post', compact('neighbourhood', 'neighbourhoods', 'id'));\n    }\n\n    public function streetscapes(Request $request)\n    {\n        $q = request()->input('q');\n        $tags = request()->input('tags');\n\n        if ($q) {\n            $streetscapes = Streetscape::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(5);\n        } elseif ($tags) {\n            $streetscapes = Streetscape::where('title','like','%' . $tags . '%')->orWhere('tags', 'like', '%' . $tags . '%')->orWhere('category', 'like', '%' . $tags . '%')->orWhere('city', 'like', '%' . $tags . '%')->orWhere('country', 'like', '%' . $tags . '%')->paginate(5);\n        } else {\n            $streetscapes = Streetscape::paginate(5);\n        }\n\n        return view('streetscapes', compact('streetscapes'));\n    }\n\n    public function streetscapes_post(Request $request)\n    {\n        $id = $request->id;\n        $allstreetscapes = Streetscape::where('id', '!=', null)->limit(3)->inRandomOrder()->get();\n        $streetscapes = Streetscape::all();\n        return view('streetscapes_post', compact('streetscapes', 'allstreetscapes', 'id'));\n    }\n\n    public function masterplans(Request $request)\n    {\n        $q = request()->input('q');\n        $size = request()->input('size');\n        $city = request()->input('city');\n        $country = request()->input('country');\n        \n        if ($q) {\n            $masterplans = Masterplan::where('title','like','%' . $q . '%')->orWhere('tags', 'like', '%' . $q . '%')->orWhere('category', 'like', '%' . $q . '%')->orWhere('city', 'like', '%' . $q . '%')->orWhere('country', 'like', '%' . $q . '%')->paginate(10);\n        } elseif ($size) {\n            $masterplans = Masterplan::where('size', 'like', '%' . $size . '%')->paginate(10);\n        }  elseif ($request->filled('city')) \n        { \n            $masters = Masterplan::where('city', '=', $city)->paginate(10);\n            $streets = Streetscape::where('city', '=', $city)->paginate(10);\n            $neighbs = Neighbourhood::where('city', '=', $city)->paginate(10);\n        } elseif ($request->filled('country')) \n        { \n            $masters = Masterplan::where('country', '=', $country)->paginate(10);\n            $streets = Streetscape::where('country', '=', $country)->paginate(10);\n            $neighbs = Neighbourhood::where('country', '=', $country)->paginate(10);\n        } else {\n            $masterplans = Masterplan::paginate(10);\n        }\n\n        $cities = City::all();\n        $countries = Country::All();\n\n        return view('masterplans', compact('masterplans', 'cities', 'countries'));\n    }\n\n    public function masterplans_post(Request $request)\n    {\n        $id = $request->id;\n        $masterplan = Masterplan::all();\n        $masterplans = Masterplan::where('id', '!=', null)\n            ->inRandomOrder()\n            ->get();\n\n\n        return view('masterplans_post', compact('masterplan', 'masterplans', 'id'));\n    }\n\n    public function alldictionary()\n    {\n        $dictionary = Dictionary::paginate(15);\n\n        return view('dictionaries', compact('dictionary'));\n    }\n\n    public function mindscapes()\n    {\n        $mindscapes = Mindscape::paginate(10);\n\n        return view('mindscapes', compact('mindscapes'));\n    }\n\n    public function mindscapes_post(Request $request)\n    {\n        $id = $request->id;\n        $allmindscapes = Mindscape::where('id', '!=', null)->limit(3)->inRandomOrder()->get();\n        $mindscapes = Mindscape::all();\n        return view('mindscapes_post', compact('mindscapes', 'allmindscapes', 'id'));\n    }\n\n\n\n\n\n    public function allwebresources()\n    {\n        $webresources = Webresource::paginate(10);\n        return view('webresources', compact('webresources'));\n    }\n\n    public function webresources_post(Request $request)\n    {\n        $id = $request->id;\n        $webresource = Webresource::where('id', '=', $id)->get();\n        return view('webresources_post', compact('webresource'));\n    }\n\n    public function dictionaries_post(Request $request)\n    {\n        $id = $request->id;\n        $dictionaries = Dictionary::all();\n        $dictionary = Dictionary::where('id', '!=', null)\n            ->inRandomOrder()\n            ->limit(5)\n            ->get();\n        return view('dictionaries_post', compact('dictionaries', 'dictionary', 'id'));\n    }\n\n\n\n    public function read(Request $request)\n    {\n        $magazines = Magazine::where('id', '!=', null);\n\n        return view('read', [\n            'magazines' => $magazines->paginate(15),\n        ]);\n    }\n\n    static function master()\n    {\n        $master = Masterplan::all();\n        //count masterplans\n        $mastercount = $master->count();\n        return $mastercount;\n    }\n\n    static function neigh()\n    {\n        $neigh = neighbourhood::all();\n        //count neighbourhoods\n        $neighcount = $neigh->count();\n        return $neighcount;\n    }\n\n    static function street()\n    {\n        $street = Streetscape::all();\n        //count streetscapes\n        $streetcount = $street->count();\n        return $streetcount;\n    }\n\n    static function mind()\n    {\n        $mind = Mindscape::all();\n        //count mindscapes\n        $mindcount = $mind->count();\n        return $mindcount;\n    }\n\n    public function deleteUser(Request $id)\n    {\n        $thisuser = User::where('id', $id)->get();\n        $thisuser[0]->delete();\n        Session::flush();\n        Auth::logout();\n        //$request->session()->invalidate();\n        return redirect('/');\n    }\n\n    public function logout()\n    {\n        Session::flush();\n        Auth::logout();\n        //$request->session()->invalidate();\n        return view('index');\n    }\n\n    static function getUsers()\n    {\n        //retrive all users\n        $users = User::all();\n        return $users;\n    }\n\n    static function getSessions()\n    {\n        //retrive all users\n        $users_session = Session::all();\n        return $users_session;\n    }\n\n    static function getLegal()\n    {\n        return view('legal');\n    }\n\n    \n    static function association()\n    {\n        return view('association');\n    }\n\n    static function getConf()\n    {\n        return view('confidentialite');\n    }\n\n    static function cookies()\n    {\n        return view('cookies');\n    }\n\n    static function subscribe()\n    {\n        return view('subscribe');\n    }\n\n    static function work()\n    {\n        return view('work');\n    }\n\n    public function import(Request $request) \n    {\n        $request->validate([\n            'file' => 'required|mimes:xls,xlsx'\n        ]);\n\n        $file = $request->file('file');\n\n        if ($request->dataType == \"masterplans\"){\n            Excel::import(new MasterplansImport, $file);\n        } elseif ($request->dataType == \"neighbourhoods\"){\n            Excel::import(new NeighbourhoodsImport, $file);\n        } elseif ($request->dataType == \"streetscapes\"){\n            Excel::import(new StreetscapesImport, $file);\n        } elseif  ($request->dataType == \"dictionaries\"){\n            Excel::import(new DictionariesImport, $file);\n        } elseif  ($request->dataType == \"magazines\"){\n            Excel::import(new MagazinesImport, $file);\n        } elseif  ($request->dataType == \"webresources\"){\n            Excel::import(new WebresourcesImport, $file);\n        } else {\n            \\Alert::success('Error.')->flash();\n            return redirect('/admin')->with('error', 'Invalid data type.');\n        }\n        \\Alert::success('Excel data imported successfully.')->flash();\n        return redirect('/admin')->with('success', 'Data imported successfully.');\n    }\n\n\n}\n"
        }
    ]
}